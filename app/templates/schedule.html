{% extends "base.html" %}
{% block content %}
{% load tz %}
{% now "Y-m-d" as current_date %}
{% now "H:i" as current_time %}

{{ current_date }}
{{ current_time }}

<section class="content-header">
  <h4><i class="fas fa-calendar-alt"></i> <b>Schedule</b></h4>
</section>

<div class="card">
	<!-- <div class="dataTables_wrapper dt-bootstrap4"> -->
		<table id="schedule_table" class="table table-bordered table-hover dataTable" role="grid">
			<thead>
				<tr class="info">
					<th style="display: none;"></th>
					<th id="th_confirmed_by_guide" scope="col" data-orderable="false">Confirmed by Guide</th>
					<th id="th_confirmed_by_incharge" scope="col" data-orderable="false">Confirmed by Incharge</th>
					<th scope="col" class="sorting" tabindex="0" rowspan="1" colspan="1">Facility</th>
					<th scope="col" class="sorting" tabindex="0" rowspan="1" colspan="1">Areas</th>
					<th scope="col" class="sorting" tabindex="0" rowspan="1" colspan="1">Date</th>
					<th scope="col" class="sorting" tabindex="0" rowspan="1" colspan="1">Start Time</th>
					<th scope="col" class="sorting" tabindex="0" rowspan="1" colspan="1">Stop Time</th>
				</tr>
			</thead>
			<tbody class="table-hover">
			  	{% for ex in excursions %}
			  		<tr id="row_excursion_data" role="row" class="odd" onclick="clickLink(this)" data-toggle="tooltip" data-placement="top" title="Click to view full information">
						<td class="ex_id" style="display: none;">{{ ex.id }}/</td>
						<td class="td_confirmed_by_guide sorting_1">
							{% if ex.confirmed_by_guide == True %}
								<h5><span class='badge badge-success'><i class='fas fa-check'></i></span></h5>
							{% else %}
								<h5><span class='badge badge-danger'><i class='fas fa-times'></i></span></h5>
							{% endif %}
						</td>
						<td class="td_confirmed_by_incharge sorting_1">
							{% if ex.confirmed_by_incharge == True %}
								<h5><span class='badge badge-success'><i class='fas fa-check'></i></span></h5>
							{% else %}
								<h5><span class='badge badge-danger'><i class='fas fa-times'></i></span></h5>
							{% endif %}
						</td>
			  			<td id="facility">{{ ex.facility }}</td>
						<td id="area">
						{% for area in ex.areas %}
							{{ area }}
						{% endfor %}
						</td>
						<td id="date_excursion">{{ ex.date }}</td>
						<td id="start_time_excursion">{{ ex.start_time|time:'H:i' }}</td>
						<td id="stop_time_excursion">{{ ex.stop_time|time:'H:i' }}</td>
					</tr>
					{% if current_date > ex.date|date:"Y-m-d" %}
						<script type="text/javascript">
							$("#row_excursion_data").css('background-color', 'Grey');
						</script>
					{% else %}
						<script type="text/javascript">
							alert('{{ current_date }}');
							alert('{{ ex.date|date:"Y-m-d" }}');
						</script>
						{% if current_date == ex.date|date:"Y-m-d" and current_time >= ex.start_time|date:"H:i" %}
							<script type="text/javascript">
								$("#row_excursion_data").css('background-color', 'Grey');
							</script>
						{% endif %}
					{% endif %}
				{% endfor %}
			  </tbody>
		</table>
	<!-- </div> -->
</div>

<script type="text/javascript">

$(document).ready(function() {

	var table = $("#schedule_table").DataTable({
		"paging": true,
		"lengthChange": false,
		"searching": true,
		"ordering": true,
		"info": true,
		"autoWidth": false,
		//"render": function ( data, type, row, meta ) {
		//  return '<a href="'+data+'">Download</a>';
		//}
	});
})

function clickLink(elem){
    location = 'get_excursion/' + elem.getElementsByClassName("ex_id")[0].innerText;
}

</script>

{% endblock %}
